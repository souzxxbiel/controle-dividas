<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no" />
<title>VENDA DO OLIVEIRA - Sistema Futurístico</title>
<style>
  /* Reset & base */
  * {
    margin:0; padding:0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  body, html {
    height: 100%; background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: #e0e0e0;
    -webkit-font-smoothing: antialiased;
  }
  a {
    color:#00e5ff; text-decoration:none;
  }
  a:hover {
    text-decoration: underline;
  }
  button {
    cursor: pointer; background: #00e5ff; border:none; padding: 10px 18px; border-radius: 8px; color:#012; font-weight: 700;
    box-shadow: 0 0 12px #00e5ffaa;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #00c3cc;
  }
  input, select {
    padding: 8px 12px; border-radius: 6px; border: none; outline:none;
    background: #001e2d; color:#00e5ff; font-weight: 600;
    box-shadow: inset 0 0 6px #00e5ff88;
    font-size: 16px;
  }
  input::placeholder {
    color:#0099aaaa;
  }
  h1, h2, h3, h4 {
    font-weight: 700;
  }
  /* Layout */
  #app {
    max-width: 480px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; background: #041e30cc; 
    box-shadow: 0 0 40px #00e5ff55;
    border-radius: 12px; padding: 20px;
  }

  /* Header */
  header {
    text-align: center; margin-bottom: 25px;
    border-bottom: 2px solid #00e5ff55; padding-bottom: 12px;
  }
  header h1 {
    font-size: 1.8rem; color:#00e5ff;
    text-shadow: 0 0 10px #00e5ffbb;
  }
  /* Login form */
  #login-container {
    display: flex; flex-direction: column; gap: 15px;
  }
  #login-container label {
    font-weight: 600; font-size: 0.9rem;
    color: #00e5ffbb;
  }
  #login-container select {
    margin-bottom: 12px;
  }
  #login-error {
    color: #ff4444; font-weight: 700; text-align: center;
    margin-top: 6px; min-height: 24px;
  }

  /* Panels */
  .panel {
    display: none;
    flex-direction: column;
    gap: 20px;
    flex-grow: 1;
  }
  .panel.active {
    display: flex;
  }
  nav.tabs {
    display: flex;
    gap: 8px;
    border-bottom: 2px solid #00e5ff55;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }
  nav.tabs button {
    flex-grow: 1;
    background: transparent;
    color: #00e5ffaa;
    font-weight: 700;
    border-radius: 6px 6px 0 0;
    box-shadow: none;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
  }
  nav.tabs button.active {
    color: #00ffff;
    background: #00475a;
    box-shadow: 0 0 15px #00ffffaa;
    border-bottom: 3px solid #00ffff;
  }

  /* Forms inside panels */
  form {
    display: flex; flex-direction: column; gap: 14px;
    background: #002f4b88;
    padding: 16px; border-radius: 10px;
    box-shadow: 0 0 12px #00e5ff55;
  }

  form label {
    font-weight: 600;
    color: #00c3cc;
  }
  form input, form select {
    width: 100%;
  }

  /* Tables */
  table {
    width: 100%; border-collapse: collapse;
    background: #002f4bcc;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 10px #00e5ff44;
  }
  th, td {
    padding: 12px 8px;
    text-align: center;
    border-bottom: 1px solid #00e5ff33;
    color: #00e5ffcc;
    font-weight: 600;
    font-size: 0.9rem;
  }
  th {
    background: #00475a;
    box-shadow: 0 0 15px #00e5ffaa inset;
  }
  tr:hover {
    background: #00475a99;
  }

  /* Scrollable tables */
  .table-wrapper {
    overflow-x: auto;
  }

  /* Scrollbar styling */
  ::-webkit-scrollbar {
    height: 8px;
    width: 8px;
  }
  ::-webkit-scrollbar-thumb {
    background: #00e5ffaa;
    border-radius: 6px;
  }
  ::-webkit-scrollbar-track {
    background: #001e2d;
  }

  /* Responsive */
  @media(max-width: 520px) {
    #app {
      max-width: 100vw; height: 100vh; padding: 10px 12px;
      border-radius: 0;
      box-shadow: none;
    }
    table, form {
      font-size: 14px;
    }
    nav.tabs button {
      font-size: 14px;
    }
    header h1 {
      font-size: 1.5rem;
    }
  }

  /* Futuristics shapes and animation */
  body::before {
    content: "";
    position: fixed; top: -150px; left: -150px; width: 500px; height: 500px;
    background: radial-gradient(circle, #00e5ff77, transparent 70%);
    filter: blur(60px);
    z-index: 0;
  }
  body::after {
    content: "";
    position: fixed; bottom: -100px; right: -100px; width: 400px; height: 400px;
    background: conic-gradient(from 0deg at 50% 50%, #00e5ff88 0deg 120deg, transparent 121deg 360deg);
    filter: blur(50px);
    z-index: 0;
  }

</style>
</head>
<body>
<div id="app">
  <header>
    <h1>VENDA DO OLIVEIRA</h1>
  </header>

  <!-- LOGIN -->
  <section id="login-section">
    <form id="login-form">
      <label for="login-role">Entrar como:</label>
      <select id="login-role" required>
        <option value="">Selecione o perfil</option>
        <option value="admin">Administrador</option>
        <option value="cliente">Cliente</option>
      </select>

      <label for="login-username">Usuário:</label>
      <input type="text" id="login-username" placeholder="Seu usuário" required autocomplete="username" />

      <label for="login-password">Senha:</label>
      <input type="password" id="login-password" placeholder="Sua senha" required autocomplete="current-password" />

      <button type="submit">Entrar</button>
    </form>
    <div id="login-error"></div>
  </section>

  <!-- PAINEL ADMIN -->
  <section id="admin-panel" class="panel" aria-label="Painel do Administrador">
    <nav class="tabs" aria-label="Navegação do painel do administrador">
      <button data-tab="produtos" class="active">Cadastrar Produtos</button>
      <button data-tab="clientes">Cadastrar Clientes</button>
      <button data-tab="devedores">Registrar Devedores</button>
      <button data-tab="solicitacoes">Solicitações</button>
      <button data-tab="estatisticas">Estatísticas</button>
      <button id="logout-admin" style="background:#ff0044; box-shadow:0 0 12px #ff0044;">Sair</button>
    </nav>

    <!-- Aba produtos -->
    <div id="tab-produtos" class="tab-content active" role="tabpanel">
      <form id="form-produto">
        <h2>Cadastrar Produto</h2>
        <label for="produto-nome">Nome do produto:</label>
        <input type="text" id="produto-nome" required placeholder="Ex: Smartphone XYZ" />

        <label for="produto-custo">Custo (R$):</label>
        <input type="number" min="0" step="0.01" id="produto-custo" required placeholder="Preço de custo" />

        <label for="produto-venda">Preço de Venda (R$):</label>
        <input type="number" min="0" step="0.01" id="produto-venda" required placeholder="Preço de venda" />

        <button type="submit">Salvar Produto</button>
      </form>
      <div class="table-wrapper" style="margin-top: 20px;">
        <table id="tabela-produtos" aria-label="Tabela de produtos cadastrados">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Custo (R$)</th>
              <th>Venda (R$)</th>
              <th>Lucro Unitário (R$)</th>
              <th>Qtd Vendida</th>
              <th>Lucro Total (R$)</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <!-- preenchido por JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Aba clientes -->
    <div id="tab-clientes" class="tab-content" role="tabpanel" hidden>
      <form id="form-cliente">
        <h2>Cadastrar Cliente</h2>
        <label for="cliente-nome">Nome do cliente:</label>
        <input type="text" id="cliente-nome" required placeholder="Nome completo" />

        <label for="cliente-usuario">Usuário (login):</label>
        <input type="text" id="cliente-usuario" required placeholder="Login único" />

        <label for="cliente-senha">Senha:</label>
        <input type="password" id="cliente-senha" required placeholder="Senha segura" />

        <button type="submit">Salvar Cliente</button>
      </form>
      <div class="table-wrapper" style="margin-top: 20px;">
        <table id="tabela-clientes" aria-label="Tabela de clientes cadastrados">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Usuário</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <!-- preenchido por JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Aba devedores -->
    <div id="tab-devedores" class="tab-content" role="tabpanel" hidden>
      <form id="form-devedor">
        <h2>Registrar Devedor</h2>

        <label for="devedor-cliente">Cliente:</label>
        <select id="devedor-cliente" required>
          <!-- preenchido por JS -->
        </select>

        <label for="devedor-produto">Produto:</label>
        <select id="devedor-produto" required>
          <!-- preenchido por JS -->
        </select>

        <label for="devedor-quantidade">Quantidade:</label>
        <input type="number" id="devedor-quantidade" min="1" value="1" required />

        <label for="devedor-parcial">Pagamento Parcial (R$):</label>
        <input type="number" id="devedor-parcial" min="0" value="0" step="0.01" required />

        <button type="submit">Registrar Dívida</button>
      </form>
      <div class="table-wrapper" style="margin-top: 20px;">
        <table id="tabela-devedores" aria-label="Tabela de devedores cadastrados">
          <thead>
            <tr>
              <th>Cliente</th>
              <th>Produto</th>
              <th>Qtd</th>
              <th>Valor Total (R$)</th>
              <th>Pago (R$)</th>
              <th>Saldo Devedor (R$)</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <!-- preenchido por JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Aba solicitações -->
    <div id="tab-solicitacoes" class="tab-content" role="tabpanel" hidden>
      <h2>Solicitações de Compra</h2>
      <div class="table-wrapper">
        <table id="tabela-solicitacoes" aria-label="Tabela de solicitações feitas pelos clientes">
          <thead>
            <tr>
              <th>Cliente</th>
              <th>Produto</th>
              <th>Qtd</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <!-- preenchido por JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Aba estatísticas -->
    <div id="tab-estatisticas" class="tab-content" role="tabpanel" hidden>
      <h2>Estatísticas Futurísticas</h2>
      <section id="estatisticas-gerais" style="display:flex; flex-direction: column; gap: 12px;">

        <div id="estat-produto-mais-vendido" style="background:#00394d; padding:12px; border-radius: 10px; box-shadow: 0 0 15px #00e5ffaa;">
          <h3>Produto Mais Vendido</h3>
          <p id="produto-mais-vendido-text">Carregando...</p>
        </div>

        <div id="estat-cliente-mais-comprou" style="background:#00394d; padding:12px; border-radius: 10px; box-shadow: 0 0 15px #00e5ffaa;">
          <h3>Cliente que mais comprou</h3>
          <p id="cliente-mais-comprou-text">Carregando...</p>
        </div>

        <div id="estat-lucro-total" style="background:#00394d; padding:12px; border-radius: 10px; box-shadow: 0 0 15px #00e5ffaa;">
          <h3>Lucro Total (R$)</h3>
          <p id="lucro-total-text">Carregando...</p>
        </div>

        <div id="estat-gasto-total" style="background:#00394d; padding:12px; border-radius: 10px; box-shadow: 0 0 15px #00e5ffaa;">
          <h3>Gasto Total (R$)</h3>
          <p id="gasto-total-text">Carregando...</p>
        </div>

      </section>
    </div>
  </section>

  <!-- PAINEL CLIENTE -->
  <section id="cliente-panel" class="panel" aria-label="Painel do Cliente" style="gap:15px;">
    <div style="display:flex; justify-content: space-between; align-items: center;">
      <h2>Bem-vindo(a), <span id="cliente-nome-display"></span></h2>
      <button id="logout-cliente" style="background:#ff0044; box-shadow:0 0 12px #ff0044;">Sair</button>
    </div>

    <h3>Produtos Disponíveis</h3>
    <div class="table-wrapper" style="max-height: 320px; overflow-y: auto;">
      <table id="tabela-produtos-cliente" aria-label="Tabela de produtos disponíveis para clientes">
        <thead>
          <tr>
            <th>Produto</th>
            <th>Preço (R$)</th>
            <th>Ação</th>
          </tr>
        </thead>
        <tbody>
          <!-- preenchido por JS -->
        </tbody>
      </table>
    </div>
  </section>
</div>

<script>
  // Dados simulados no localStorage
  // Senha dos usuários serão salvas como hash simples para não deixar em texto puro - (simples base64 para demo, NUNCA use assim em produção)
  // Admin inicial fixo: usuário: admin senha: admin123
  // Clientes e produtos criados dinamicamente

  // Helpers
  function shaBase64(str) {
    // simples hash base64 (não seguro para produção, só demo)
    return btoa(unescape(encodeURIComponent(str)));
  }

  // Carregar dados do localStorage ou iniciar vazio
  function loadData() {
    return {
      usuarios: JSON.parse(localStorage.getItem('usuarios') || '[]'),
      produtos: JSON.parse(localStorage.getItem('produtos') || '[]'),
      devedores: JSON.parse(localStorage.getItem('devedores') || '[]'),
      solicitacoes: JSON.parse(localStorage.getItem('solicitacoes') || '[]'),
    };
  }
  function saveData(data) {
    localStorage.setItem('usuarios', JSON.stringify(data.usuarios));
    localStorage.setItem('produtos', JSON.stringify(data.produtos));
    localStorage.setItem('devedores', JSON.stringify(data.devedores));
    localStorage.setItem('solicitacoes', JSON.stringify(data.solicitacoes));
  }

  // Inicializar admin se não existir
  function initAdmin(data) {
    if (!data.usuarios.find(u => u.role === 'admin')) {
      data.usuarios.push({
        id: 'admin-1',
        nome: 'Administrador Principal',
        usuario: 'admin',
        senha: shaBase64('admin123'),
        role: 'admin'
      });
      saveData(data);
    }
  }

  // Variáveis globais
  let appData = loadData();
  initAdmin(appData);
  let usuarioLogado = null;

  // Elements
  const loginSection = document.getElementById('login-section');
  const loginForm = document.getElementById('login-form');
  const loginRole = document.getElementById('login-role');
  const loginUser = document.getElementById('login-username');
  const loginPass = document.getElementById('login-password');
  const loginError = document.getElementById('login-error');

  const adminPanel = document.getElementById('admin-panel');
  const clientePanel = document.getElementById('cliente-panel');

  const tabsButtons = adminPanel.querySelectorAll('nav.tabs button[data-tab]');
  const tabContents = adminPanel.querySelectorAll('.tab-content');

  // --- Função para alternar abas no admin
  function ativarAba(tabName) {
    tabsButtons.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.tab === tabName);
    });
    tabContents.forEach(tab => {
      tab.hidden = tab.id !== 'tab-' + tabName;
      tab.classList.toggle('active', tab.id === 'tab-' + tabName);
    });
  }
  tabsButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      ativarAba(btn.dataset.tab);
    });
  });

  // Logout
  document.getElementById('logout-admin').addEventListener('click', () => {
    usuarioLogado = null;
    loginForm.reset();
    loginError.textContent = '';
    toggleSections();
  });
  document.getElementById('logout-cliente').addEventListener('click', () => {
    usuarioLogado = null;
    loginForm.reset();
    loginError.textContent = '';
    toggleSections();
  });

  // Toggle visibilidade se está logado e qual painel mostrar
  function toggleSections() {
    if (!usuarioLogado) {
      loginSection.style.display = 'flex';
      adminPanel.style.display = 'none';
      clientePanel.style.display = 'none';
    } else if (usuarioLogado.role === 'admin') {
      loginSection.style.display = 'none';
      adminPanel.style.display = 'flex';
      clientePanel.style.display = 'none';
      ativarAba('produtos');
      carregarProdutosTabela();
      carregarClientesTabela();
      carregarDevedoresTabela();
      carregarSolicitacoesTabela();
      carregarEstatisticas();
      preencherSelectDevedores();
    } else if (usuarioLogado.role === 'cliente') {
      loginSection.style.display = 'none';
      adminPanel.style.display = 'none';
      clientePanel.style.display = 'flex';
      document.getElementById('cliente-nome-display').textContent = usuarioLogado.nome;
      carregarProdutosCliente();
    }
  }

  toggleSections();

  // LOGIN
  loginForm.addEventListener('submit', (e) => {
    e.preventDefault();
    loginError.textContent = '';
    const role = loginRole.value.trim();
    const usuario = loginUser.value.trim();
    const senha = loginPass.value.trim();

    if (!role || !usuario || !senha) {
      loginError.textContent = 'Preencha todos os campos!';
      return;
    }

    const userFound = appData.usuarios.find(u => u.usuario === usuario && u.role === role);
    if (!userFound) {
      loginError.textContent = 'Usuário ou perfil inválido!';
      return;
    }
    if (userFound.senha !== shaBase64(senha)) {
      loginError.textContent = 'Senha incorreta!';
      return;
    }
    usuarioLogado = userFound;
    toggleSections();
  });

  // --- CADASTRO DE PRODUTOS ---
  const formProduto = document.getElementById('form-produto');
  formProduto.addEventListener('submit', (e) => {
    e.preventDefault();

    const nome = document.getElementById('produto-nome').value.trim();
    const custo = parseFloat(document.getElementById('produto-custo').value);
    const venda = parseFloat(document.getElementById('produto-venda').value);

    if (!nome || isNaN(custo) || isNaN(venda) || custo < 0 || venda < 0) {
      alert('Preencha os dados corretamente!');
      return;
    }

    // Verificar se produto já existe (nome único)
    if (appData.produtos.find(p => p.nome.toLowerCase() === nome.toLowerCase())) {
      alert('Produto já cadastrado!');
      return;
    }

    const novoProduto = {
      id: 'p-' + Date.now(),
      nome,
      custo,
      venda,
      vendidos: 0, // quantidade vendida para estatísticas
    };

    appData.produtos.push(novoProduto);
    saveData(appData);
    formProduto.reset();
    carregarProdutosTabela();
    preencherSelectDevedores();
    alert('Produto cadastrado com sucesso!');
  });

  // Preencher tabela de produtos admin
  function carregarProdutosTabela() {
    const tbody = document.querySelector('#tabela-produtos tbody');
    tbody.innerHTML = '';
    if (appData.produtos.length === 0) {
      tbody.innerHTML = `<tr><td colspan="7">Nenhum produto cadastrado</td></tr>`;
      return;
    }
    for (const p of appData.produtos) {
      const lucroUnit = (p.venda - p.custo).toFixed(2);
      const lucroTotal = (lucroUnit * p.vendidos).toFixed(2);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.nome}</td>
        <td>${p.custo.toFixed(2)}</td>
        <td>${p.venda.toFixed(2)}</td>
        <td>${lucroUnit}</td>
        <td>${p.vendidos}</td>
        <td>${lucroTotal}</td>
        <td><button data-id="${p.id}" class="btn-delete-produto" style="background:#ff4444;">Excluir</button></td>
      `;
      tbody.appendChild(tr);
    }
    // Delete produto
    document.querySelectorAll('.btn-delete-produto').forEach(btn => {
      btn.onclick = () => {
        if (confirm('Excluir produto? Esta ação não pode ser desfeita!')) {
          appData.produtos = appData.produtos.filter(p => p.id !== btn.dataset.id);
          saveData(appData);
          carregarProdutosTabela();
          preencherSelectDevedores();
        }
      };
    });
  }

  // --- CADASTRO DE CLIENTES ---
  const formCliente = document.getElementById('form-cliente');
  formCliente.addEventListener('submit', (e) => {
    e.preventDefault();

    const nome = document.getElementById('cliente-nome').value.trim();
    const usuario = document.getElementById('cliente-usuario').value.trim();
    const senha = document.getElementById('cliente-senha').value.trim();

    if (!nome || !usuario || !senha) {
      alert('Preencha os dados corretamente!');
      return;
    }
    if (appData.usuarios.find(u => u.usuario === usuario)) {
      alert('Usuário já existe!');
      return;
    }

    const novoCliente = {
      id: 'c-' + Date.now(),
      nome,
      usuario,
      senha: shaBase64(senha),
      role: 'cliente',
    };
    appData.usuarios.push(novoCliente);
    saveData(appData);
    formCliente.reset();
    carregarClientesTabela();
    preencherSelectDevedores();
    alert('Cliente cadastrado com sucesso!');
  });

  // Preencher tabela clientes admin
  function carregarClientesTabela() {
    const tbody = document.querySelector('#tabela-clientes tbody');
    tbody.innerHTML = '';
    const clientes = appData.usuarios.filter(u => u.role === 'cliente');
    if (clientes.length === 0) {
      tbody.innerHTML = `<tr><td colspan="3">Nenhum cliente cadastrado</td></tr>`;
      return;
    }
    for (const c of clientes) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${c.nome}</td>
        <td>${c.usuario}</td>
        <td><button data-id="${c.id}" class="btn-delete-cliente" style="background:#ff4444;">Excluir</button></td>
      `;
      tbody.appendChild(tr);
    }
    // Delete cliente
    document.querySelectorAll('.btn-delete-cliente').forEach(btn => {
      btn.onclick = () => {
        if (confirm('Excluir cliente? Esta ação não pode ser desfeita!')) {
          // Remover cliente e dívidas e solicitações relacionadas
          appData.usuarios = appData.usuarios.filter(u => u.id !== btn.dataset.id);
          appData.devedores = appData.devedores.filter(d => d.clienteId !== btn.dataset.id);
          appData.solicitacoes = appData.solicitacoes.filter(s => s.clienteId !== btn.dataset.id);
          saveData(appData);
          carregarClientesTabela();
          carregarDevedoresTabela();
          carregarSolicitacoesTabela();
          preencherSelectDevedores();
        }
      };
    });
  }

  // --- CADASTRO DE DEVEDORES (DÍVIDAS) ---
  const formDevedor = document.getElementById('form-devedor');
  const selectDevedorCliente = document.getElementById('devedor-cliente');
  const selectDevedorProduto = document.getElementById('devedor-produto');

  formDevedor.addEventListener('submit', (e) => {
    e.preventDefault();

    const clienteId = selectDevedorCliente.value;
    const produtoId = selectDevedorProduto.value;
    const quantidade = parseInt(document.getElementById('devedor-quantidade').value);
    const pagamentoParcial = parseFloat(document.getElementById('devedor-parcial').value);

    if (!clienteId || !produtoId || isNaN(quantidade) || quantidade < 1 || isNaN(pagamentoParcial) || pagamentoParcial < 0) {
      alert('Preencha os dados corretamente!');
      return;
    }

    // Busca produto para cálculo
    const produto = appData.produtos.find(p => p.id === produtoId);
    if (!produto) {
      alert('Produto inválido!');
      return;
    }

    const valorTotal = produto.venda * quantidade;
    if (pagamentoParcial > valorTotal) {
      alert('Pagamento parcial não pode ser maior que o valor total!');
      return;
    }

    const novaDivida = {
      id: 'd-' + Date.now(),
      clienteId,
      produtoId,
      quantidade,
      valorTotal,
      pago: pagamentoParcial,
    };

    appData.devedores.push(novaDivida);
    saveData(appData);
    formDevedor.reset();
    carregarDevedoresTabela();
    alert('Dívida registrada!');
  });

  // Preencher selects no formulário de devedor
  function preencherSelectDevedores() {
    // clientes
    selectDevedorCliente.innerHTML = '';
    const clientes = appData.usuarios.filter(u => u.role === 'cliente');
    if (clientes.length === 0) {
      selectDevedorCliente.innerHTML = '<option disabled>Nenhum cliente cadastrado</option>';
    } else {
      selectDevedorCliente.innerHTML = clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
    }
    // produtos
    selectDevedorProduto.innerHTML = '';
    if (appData.produtos.length === 0) {
      selectDevedorProduto.innerHTML = '<option disabled>Nenhum produto cadastrado</option>';
    } else {
      selectDevedorProduto.innerHTML = appData.produtos.map(p => `<option value="${p.id}">${p.nome}</option>`).join('');
    }
  }

  // Preencher tabela de devedores admin
  function carregarDevedoresTabela() {
    const tbody = document.querySelector('#tabela-devedores tbody');
    tbody.innerHTML = '';
    if (appData.devedores.length === 0) {
      tbody.innerHTML = `<tr><td colspan="7">Nenhuma dívida registrada</td></tr>`;
      return;
    }
    for (const d of appData.devedores) {
      const cliente = appData.usuarios.find(u => u.id === d.clienteId);
      const produto = appData.produtos.find(p => p.id === d.produtoId);
      if (!cliente || !produto) continue;
      const saldo = d.valorTotal - d.pago;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${cliente.nome}</td>
        <td>${produto.nome}</td>
        <td>${d.quantidade}</td>
        <td>${d.valorTotal.toFixed(2)}</td>
        <td>${d.pago.toFixed(2)}</td>
        <td>${saldo.toFixed(2)}</td>
        <td><button data-id="${d.id}" class="btn-delete-divida" style="background:#ff4444;">Excluir</button></td>
      `;
      tbody.appendChild(tr);
    }
    // Delete dívida
    document.querySelectorAll('.btn-delete-divida').forEach(btn => {
      btn.onclick = () => {
        if (confirm('Excluir dívida? Esta ação não pode ser desfeita!')) {
          appData.devedores = appData.devedores.filter(d => d.id !== btn.dataset.id);
          saveData(appData);
          carregarDevedoresTabela();
        }
      };
    });
  }

  // --- SOLICITAÇÕES DE COMPRA (CLIENTES) ---
  // Cliente pode solicitar produtos da lista, salvando na appData.solicitacoes com status pendente

  // Carregar produtos para cliente
  const tabelaProdutosClienteBody = document.querySelector('#tabela-produtos-cliente tbody');

  function carregarProdutosCliente() {
    tabelaProdutosClienteBody.innerHTML = '';
    if (appData.produtos.length === 0) {
      tabelaProdutosClienteBody.innerHTML = `<tr><td colspan="3">Nenhum produto disponível</td></tr>`;
      return;
    }
    for (const p of appData.produtos) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.nome}</td>
        <td>${p.venda.toFixed(2)}</td>
        <td><button data-id="${p.id}" class="btn-solicitar-produto">Solicitar</button></td>
      `;
      tabelaProdutosClienteBody.appendChild(tr);
    }
    // Botão solicitar produto
    document.querySelectorAll('.btn-solicitar-produto').forEach(btn => {
      btn.onclick = () => {
        const produtoId = btn.dataset.id;
        const produto = appData.produtos.find(p => p.id === produtoId);
        if (!produto) {
          alert('Produto não encontrado!');
          return;
        }
        // Perguntar quantidade
        let qtdStr = prompt(`Informe a quantidade para solicitar do produto "${produto.nome}":`, "1");
        if (!qtdStr) return;
        let qtd = parseInt(qtdStr);
        if (isNaN(qtd) || qtd < 1) {
          alert('Quantidade inválida!');
          return;
        }
        // Salvar solicitação
        appData.solicitacoes.push({
          id: 's-' + Date.now(),
          clienteId: usuarioLogado.id,
          produtoId,
          quantidade: qtd,
          status: 'pendente', // pendente, aprovado, rejeitado
        });
        saveData(appData);
        carregarSolicitacoesTabela();
        alert('Solicitação enviada!');
      };
    });
  }

  // Preencher tabela de solicitações admin
  function carregarSolicitacoesTabela() {
    const tbody = document.querySelector('#tabela-solicitacoes tbody');
    tbody.innerHTML = '';
    if (appData.solicitacoes.length === 0) {
      tbody.innerHTML = `<tr><td colspan="5">Nenhuma solicitação feita</td></tr>`;
      return;
    }
    for (const s of appData.solicitacoes) {
      const cliente = appData.usuarios.find(u => u.id === s.clienteId);
      const produto = appData.produtos.find(p => p.id === s.produtoId);
      if (!cliente || !produto) continue;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${cliente.nome}</td>
        <td>${produto.nome}</td>
        <td>${s.quantidade}</td>
        <td>${s.status}</td>
        <td>
          ${s.status === 'pendente' ? 
            `<button data-id="${s.id}" class="btn-aprovar-solicitacao" style="background:#00cc00;">Aprovar</button> 
            <button data-id="${s.id}" class="btn-rejeitar-solicitacao" style="background:#cc0000;">Rejeitar</button>` 
            : '-'}
        </td>
      `;
      tbody.appendChild(tr);
    }

    // Botões aprovar/rejeitar
    document.querySelectorAll('.btn-aprovar-solicitacao').forEach(btn => {
      btn.onclick = () => {
        if (confirm('Aprovar esta solicitação?')) {
          const id = btn.dataset.id;
          const sol = appData.solicitacoes.find(s => s.id === id);
          if (sol) {
            sol.status = 'aprovado';
            // Incrementa vendido no produto para estatística
            const prod = appData.produtos.find(p => p.id === sol.produtoId);
            if (prod) {
              prod.vendidos += sol.quantidade;
            }
            saveData(appData);
            carregarSolicitacoesTabela();
            carregarProdutosTabela();
            carregarEstatisticas();
            alert('Solicitação aprovada!');
          }
        }
      };
    });
    document.querySelectorAll('.btn-rejeitar-solicitacao').forEach(btn => {
      btn.onclick = () => {
        if (confirm('Rejeitar esta solicitação?')) {
          const id = btn.dataset.id;
          const solIndex = appData.solicitacoes.findIndex(s => s.id === id);
          if (solIndex !== -1) {
            appData.solicitacoes[solIndex].status = 'rejeitado';
            saveData(appData);
            carregarSolicitacoesTabela();
            alert('Solicitação rejeitada!');
          }
        }
      };
    });
  }

  // --- ESTATÍSTICAS ---
  function carregarEstatisticas() {
    // Produto mais vendido
    if (appData.produtos.length === 0) {
      document.getElementById('produto-mais-vendido-text').textContent = 'Nenhum produto cadastrado';
      document.getElementById('cliente-mais-comprou-text').textContent = 'Nenhum cliente cadastrado';
      document.getElementById('lucro-total-text').textContent = '0.00';
      document.getElementById('gasto-total-text').textContent = '0.00';
      return;
    }

    // Produto mais vendido
    let maisVendido = appData.produtos.reduce((max, p) => p.vendidos > max.vendidos ? p : max, appData.produtos[0]);
    document.getElementById('produto-mais-vendido-text').textContent = `${maisVendido.nome} (${maisVendido.vendidos} vendidos)`;

    // Cliente que mais comprou
    // Conta quantidade de solicitações aprovadas por cliente
    const clientes = appData.usuarios.filter(u => u.role === 'cliente');
    if (clientes.length === 0) {
      document.getElementById('cliente-mais-comprou-text').textContent = 'Nenhum cliente cadastrado';
    } else {
      let compraPorCliente = {};
      for (const c of clientes) {
        compraPorCliente[c.id] = 0;
      }
      for (const s of appData.solicitacoes) {
        if (s.status === 'aprovado') {
          compraPorCliente[s.clienteId] = (compraPorCliente[s.clienteId] || 0) + s.quantidade;
        }
      }
      let idMais = Object.keys(compraPorCliente).reduce((maxId, id) => compraPorCliente[id] > compraPorCliente[maxId] ? id : maxId, clientes[0].id);
      let clienteMais = clientes.find(c => c.id === idMais);
      let qtdMais = compraPorCliente[idMais];
      document.getElementById('cliente-mais-comprou-text').textContent = `${clienteMais.nome} (${qtdMais} produtos comprados)`;
    }

    // Lucro total
    let lucroTotal = 0;
    for (const p of appData.produtos) {
      lucroTotal += (p.venda - p.custo) * p.vendidos;
    }
    document.getElementById('lucro-total-text').textContent = lucroTotal.toFixed(2);

    // Gasto total
    let gastoTotal = 0;
    for (const p of appData.produtos) {
      gastoTotal += p.custo * p.vendidos;
    }
    document.getElementById('gasto-total-text').textContent = gastoTotal.toFixed(2);
  }

</script>
</body>
</html>
