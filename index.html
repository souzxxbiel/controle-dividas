<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestor de Clientes</title>
  <style>
    :root {
      --cor-primaria: #0f0c29;
      --cor-secundaria: #302b63;
      --cor-destaque: #e94057;
      --texto-claro: #fff;
      --texto-escuro: #111;
      --bg-gradiente: linear-gradient(135deg, #0f0c29, #302b63, #e94057);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg-gradiente);
      color: var(--texto-claro);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background: rgba(0,0,0,0.6);
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      backdrop-filter: blur(4px);
    }

    nav {
      display: flex;
      justify-content: space-around;
      background: rgba(0,0,0,0.3);
      padding: 0.5rem;
    }

    nav button {
      background: var(--cor-destaque);
      color: var(--texto-claro);
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    nav button:hover {
      transform: scale(1.05);
    }

    main {
      flex: 1;
      padding: 1rem;
    }

    .aba {
      display: none;
    }

    .ativa {
      display: block;
    }

    label {
      display: block;
      margin-top: 1rem;
    }

    input, textarea {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.2rem;
      border-radius: 6px;
      border: none;
    }

    button.salvar {
      background: #38b6ff;
      color: white;
      margin-top: 1rem;
    }

    .card {
      background: rgba(255,255,255,0.1);
      padding: 1rem;
      margin: 0.5rem 0;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    .card button {
      margin: 0.2rem;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .top-bar input {
      flex: 1;
      margin-left: 1rem;
    }

    footer {
      text-align: center;
      padding: 1rem;
      background: rgba(0,0,0,0.4);
    }
  </style>
</head>
<body>
  <header>Gestor de Clientes</header>

  <nav>
    <button onclick="mostrarAba('cadastro')">Cadastro</button>
    <button onclick="mostrarAba('historico')">Histórico</button>
    <button onclick="mostrarAba('somas')">Somas</button>
  </nav>

  <main>
    <section id="cadastro" class="aba ativa">
      <label>Nome:</label>
      <input id="nome" list="nomes" autocomplete="off">
      <datalist id="nomes"></datalist>

      <label>Valor:</label>
      <input id="valor" type="number" step="0.01" autocomplete="off">

      <label>Telefone:</label>
      <input id="telefone" type="tel" autocomplete="off">

      <label>Observação:</label>
      <textarea id="obs"></textarea>

      <button class="salvar" onclick="salvarCliente()">Salvar Cliente</button>
    </section>

    <section id="historico" class="aba">
      <div class="top-bar">
        <button onclick="restaurarBackup()">Restaurar Backup</button>
        <input id="pesquisaHistorico" placeholder="Pesquisar..." oninput="renderHistorico(this.value)">
      </div>
      <div id="listaHistorico"></div>
    </section>

    <section id="somas" class="aba">
      <input id="pesquisaSomas" placeholder="Pesquisar..." oninput="renderSomas(this.value)">
      <div id="listaSomas"></div>
    </section>
  </main>

  <footer>© 2025</footer>

  <script>
    const chavePix = "054.167.380-73";

    function mostrarAba(id) {
      document.querySelectorAll('.aba').forEach(el => el.classList.remove('ativa'));
      document.getElementById(id).classList.add('ativa');
    }

    function salvarCliente() {
      const nome = document.getElementById("nome").value.trim();
      const valor = document.getElementById("valor").value.trim();
      const telefone = document.getElementById("telefone").value.trim();
      const obs = document.getElementById("obs").value.trim();
      if (!nome || !valor) return;

      const clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
      clientes.unshift({ nome, valor, telefone, obs, data: new Date().toLocaleString() });
      localStorage.setItem("clientes", JSON.stringify(clientes));

      const nomes = new Set(clientes.map(c => c.nome));
      document.getElementById("nomes").innerHTML = [...nomes].map(n => `<option value="${n}">`).join("");

      baixarBackup();
      renderHistorico();
      renderSomas();
      document.getElementById("nome").value = "";
      document.getElementById("valor").value = "";
      document.getElementById("telefone").value = "";
      document.getElementById("obs").value = "";
    }

    function renderHistorico(filtro = "") {
      const container = document.getElementById("listaHistorico");
      container.innerHTML = "";
      const dados = JSON.parse(localStorage.getItem("clientes") || "[]");
      dados.filter(c => c.nome.toLowerCase().includes(filtro.toLowerCase()))
        .forEach((c, i) => {
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            <strong>${c.nome}</strong> - R$ ${c.valor}<br>
            ${c.telefone ? `Tel: ${c.telefone}<br>` : ""}
            ${c.obs ? `Obs: ${c.obs}<br>` : ""}
            <small>${c.data}</small><br>
            <button onclick="editarCliente(${i})">Editar</button>
            <button onclick="excluirCliente(${i})">Excluir</button>
          `;
          container.appendChild(div);
        });
    }

    function renderSomas(filtro = "") {
      const container = document.getElementById("listaSomas");
      container.innerHTML = "";
      const dados = JSON.parse(localStorage.getItem("clientes") || "[]");
      const resumo = {};
      const telefones = {};
      dados.forEach(c => {
        if (!resumo[c.nome]) {
          resumo[c.nome] = 0;
          telefones[c.nome] = c.telefone || "";
        }
        resumo[c.nome] += parseFloat(c.valor || 0);
      });
      Object.entries(resumo)
        .filter(([nome]) => nome.toLowerCase().includes(filtro.toLowerCase()))
        .forEach(([nome, total]) => {
          const telefone = telefones[nome].replace(/\D/g, "");
          const mensagem = encodeURIComponent(
            `Olá ${nome}, você possui um débito no valor de R$ ${total.toFixed(2)}.\n\nSegue os dados para pagamento via PIX:\nChave PIX: ${chavePix}`
          );
          const linkWhatsApp = telefone ? `https://wa.me/55${telefone}?text=${mensagem}` : "#";
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            <strong>${nome}</strong><br>
            Total: R$ ${total.toFixed(2)}<br>
            <a href="${linkWhatsApp}" target="_blank">
              <button style="background:#25D366;color:#fff;margin-top:10px">Cobrar via WhatsApp</button>
            </a>
          `;
          container.appendChild(div);
        });
    }

    function editarCliente(i) {
      const dados = JSON.parse(localStorage.getItem("clientes") || "[]");
      const c = dados[i];
      document.getElementById("nome").value = c.nome;
      document.getElementById("valor").value = c.valor;
      document.getElementById("telefone").value = c.telefone;
      document.getElementById("obs").value = c.obs;
      dados.splice(i, 1);
      localStorage.setItem("clientes", JSON.stringify(dados));
      renderHistorico();
      renderSomas();
      mostrarAba('cadastro');
    }

    function excluirCliente(i) {
      if (!confirm("Deseja realmente excluir este cliente?")) return;
      const dados = JSON.parse(localStorage.getItem("clientes") || "[]");
      dados.splice(i, 1);
      localStorage.setItem("clientes", JSON.stringify(dados));
      renderHistorico();
      renderSomas();
    }

    function baixarBackup() {
      const blob = new Blob([localStorage.getItem("clientes") || "[]"], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "backup_clientes.json";
      a.click();
    }

    function restaurarBackup() {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = ".json";
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
          try {
            localStorage.setItem("clientes", reader.result);
            renderHistorico();
            renderSomas();
          } catch {}
        };
        reader.readAsText(file);
      };
      input.click();
    }

    window.onload = () => {
      renderHistorico();
      renderSomas();
    };
  </script>
</body>
</html>
